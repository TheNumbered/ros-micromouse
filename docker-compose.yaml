version: '1.0'

services:
    develop:
        image: deli/micromouse
        command: /bin/bash

        stdin_open: true
        tty: true

        environment:
            - "DISPLAY"
            - "QT_X11_NO_MITSHM=1"
        volumes:
            - /home/deli/Documents/husarion/ros-micromouse/ws:/root/ws

        network_mode: host


    build:
        image: deli/micromouse
        command: bash -c "cd /root/ws && colcon build "
        volumes:
            - /home/deli/Documents/husarion/ros-micromouse/ws:/root/ws

    bringup_micromouse:
        image: deli/micromouse
        network_mode: host
        environment:
            - "DISPLAY"
            - "QT_X11_NO_MITSHM=1"
        depends_on:
            build:
                  condition: service_started
        command: bash -c "source /root/ws/install/setup.bash && ros2 launch micromouse_bringup micromouse_bringup.launch.py"
        volumes:
            - /tmp/.X11-unix:/tmp/.X11-unix
            - /dev/dri:/dev/dri
            - /home/deli/Documents/husarion/ros-micromouse/ws:/root/

    rviz:
        image: deli/micromouse
        command: bash -c "source /root/ws/install/setup.bash && rviz2 -d /root/ws/src/micromouse_description/rviz/micromouse_rviz.rviz"
        volumes:
            - /home/deli/Documents/husarion/ros-micromouse/ws:/root/
            - /tmp/.X11-unix:/tmp/.X11-unix
            - /dev/dri:/dev/dri
        network_mode: host
        environment:
            - "DISPLAY"
            - "QT_X11_NO_MITSHM=1"

            # - "NVIDIA_VISIBLE_DEVICES=-all"
            # - "NVIDIA_DRIVER_CAPABILITIES=+$NVIDIA_DRIVER_CAPABILITIES"

